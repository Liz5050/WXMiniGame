import { GameType } from "../../enum/GameType";
import { EventEnum } from "../../enum/EventEnum";
import { EventManager } from "../../manager/EventManager";
import { resources , Node, utils} from "cc";
import { GameGridStartView } from "./view/GameGridStartView";

export default class GameGridController {
    private _gameGridNode:Node;
    public constructor(){
        this.init();
    }

    private init(){
        EventManager.addListener(EventEnum.OnGameStart,this.onGameStart,this);
    }

    private onGameStart(type:GameType):void {
        if(type != GameType.Grid) return;
        
        let url:string = "prefab/GameGridMapItem";
        if(resources.get(url)){
            this.start();
        }else{
            let self = this;
            resources.load(url,function(){
                self.start();
            });
        }
    }

    private start(){
        if(!this._gameGridNode){
            this._gameGridNode = utils.find("Canvas/Main/Game/GameGrid");
        }
        else{
            let com:GameGridStartView = this._gameGridNode.getComponent(GameGridStartView);
            com.OnGameStart();
        }
        this._gameGridNode.active = true;
    }
}