{"version":3,"sources":["file:///G:/Work/cocoscreator/svn/MiniGame/assets/script/common/AudioPlayer.ts"],"names":["_decorator","Component","AudioSource","resources","ccclass","property","AudioPlayer","_audioPlayers","_audioIdx","_audioLastIdx","_bgmPlayer","_isMute","start","audio","node","getChildByName","getComponent","push","onUpdate","dt","play","audioName","stopLast","stop","clip","source","url","playByUrl","playBGM","stopBGM","idx","audioClip","get","load","error","setMute","isMute","i","length","volume","onPause","pause","onResume","onDestroy"],"mappings":"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","sourcesContent":["import { _decorator, Component, AudioSource, resources, AudioClip } from 'cc';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('AudioPlayer')\r\nexport class AudioPlayer extends Component {\r\n    private _audioPlayers:AudioSource[];\r\n    private _audioIdx:number;\r\n    private _audioLastIdx:number;\r\n    private _bgmPlayer:AudioSource;\r\n    private _isMute:boolean;\r\n\r\n    public start() {\r\n        this._audioPlayers = [];\r\n        this._audioIdx = 0;\r\n        this._audioLastIdx = -1;\r\n        let audio:AudioSource = this.node.getChildByName(\"Sound1\").getComponent(AudioSource);\r\n        this._audioPlayers.push(audio);\r\n        audio = this.node.getChildByName(\"Sound2\").getComponent(AudioSource);\r\n        this._audioPlayers.push(audio);\r\n        audio = this.node.getChildByName(\"Sound3\").getComponent(AudioSource);\r\n        this._audioPlayers.push(audio);\r\n\r\n        this._bgmPlayer = this.node.getChildByName(\"BGM\").getComponent(AudioSource);\r\n        // this._audioPlayer = this.getComponent(engine.AudioSource);\r\n    }\r\n\r\n    public onUpdate(dt) {\r\n\r\n    }\r\n\r\n    public play(audioName:string,stopLast:boolean = true) {\r\n        if (stopLast) {\r\n            if(this._audioLastIdx >= 0){\r\n                this._audioPlayers[this._audioLastIdx].stop();\r\n                this._audioPlayers[this._audioLastIdx].clip = null;\r\n            }\r\n        }\r\n        this._audioIdx = this._audioLastIdx + 1;\r\n        this._audioLastIdx = this._audioIdx;\r\n        if(this._audioIdx >= 3){\r\n            this._audioIdx = 0;\r\n            this._audioLastIdx = 0;\r\n        }\r\n        let source:AudioSource = this._audioPlayers[this._audioIdx];\r\n        let url:string = \"audio/\" + audioName;\r\n        this.playByUrl(url,source);\r\n    }\r\n\r\n    public playBGM(audioName:string){\r\n        let url:string = \"bgm/\" + audioName;\r\n        this.playByUrl(url,this._bgmPlayer);\r\n    }\r\n    \r\n    public stopBGM(){\r\n        this._bgmPlayer.stop();\r\n        this._bgmPlayer.clip = null;\r\n    }\r\n\r\n    public playByUrl(url:string,source:AudioSource){\r\n        if(!source){\r\n            let idx:number = this._audioLastIdx >= 0 ? this._audioLastIdx : 0;\r\n            source = this._audioPlayers[idx];\r\n        }\r\n        let audioClip = resources.get(url) as AudioClip;\r\n        if(audioClip){\r\n            source.clip = audioClip;\r\n            source.play();\r\n        }else{\r\n            resources.load(url,function(error:Error,audio){\r\n                source.clip = audio as AudioClip;\r\n                source.play();\r\n            });\r\n        }\r\n    }\r\n\r\n    public setMute(isMute:boolean){\r\n        this._isMute = isMute;\r\n        for(let i = 0;i < this._audioPlayers.length; i++){\r\n            this._audioPlayers[i].volume = isMute ? 0 : 1;\r\n        }\r\n    }\r\n\r\n    public onPause(){\r\n        this._bgmPlayer.pause();\r\n    }\r\n\r\n    public onResume(){\r\n        this._bgmPlayer.play();\r\n    }\r\n\r\n    public onDestroy() {\r\n\r\n    }\r\n}\r\n\r\n\r\n\r\n"]}