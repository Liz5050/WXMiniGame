{"version":3,"sources":["file:///G:/Work/cocoscreator/MiniGame/assets/script/game/gameGrid/view/GameGridStartView.ts"],"names":["MapGridItem","BtnPreviewGrid","_decorator","Button","Component","instantiate","Label","math","Node","NodeEventType","resources","EventManager","EventEnum","TweenManager","Mgr","GameType","ccclass","property","GameGridStartView","_previewGrid1","_previewGrid2","_previewGrid3","_txtScore","_mapItemList","_mapContainer","_rightCount","_score","update","dt","start","console","log","node","getChildByPath","getChildByName","gridIndex","getComponent","string","btnExit","self","on","EventType","CLICK","uploadScore","exitClear","dispatch","OnGameExit","Grid","initMapGrid","addListener","OnGameGridTouchEnd","OnTouchEndCheck","OnGameGridReqNextPreview","OnReqNextPreview","row","col","item","init","updatePreviewGrid","index","gridList","num","length","emptyNum","itemArr","i","grid","localPos","transform2D","convertWorldPositionToLocal","worldPosition","x","y","idx","ConvertXYToIndex","isEmpty","push","checkListX","checkListY","setEmpty","indexOf","UpdateTouchEndResult","splice","canRemove","lenX","lenY","soundMgr","play","posX","posY","Math","round","abs","OnGameStart","active","k","_col","_row","_posX","_posY","_itemEntity","_container","_posArr","_isEmpty","_playTween","consturctor","container","initUI","url","prefabAsset","get","addChild","setPosition","bool","playTween","col_row","clearTween","scale","getScale","addTween","wait","to","removeTweens","position","getItemWorldPos","getWorldPosition","constructor","_touchMask","_preview","_previewPos","_previewScale","_previewX","_previewY","_moveStartX","_moveStartY","_offsetX","_offsetY","_canMove","_gridIndex","_randomGrid","_lastRandomGrid","_gridList","_btnGrid","_node","getPosition","TOUCH_CANCEL","touchEnd","TOUCH_END","TOUCH_START","target","event","touches","touchStart","TOUCH_MOVE","touchMove","startX","startY","moveX","moveY","offsetX","offsetY","pos","isRight","itemList","Vec3","inverseTransformPoint","call","setScale","gridIdx","random","updatePreview","load","destroy","children","setRotation","entity","rotation","PI","scaleX","scaleY"],"mappings":"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","sourcesContent":["import { _decorator, Button, Component, instantiate, Label, math, Node, NodeEventType, Prefab, resources, Tween, tween } from 'cc';\r\nimport { EventManager } from '../../../manager/EventManager';\r\nimport { EventEnum } from '../../../enum/EventEnum';\r\nimport TweenManager from '../../../common/TweenManager';\r\nimport Mgr from '../../../manager/Mgr';\r\nimport { GameType } from '../../../enum/GameType';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('GameGridStartView')\r\nexport class GameGridStartView extends Component {\r\n    private _previewGrid1:BtnPreviewGrid;\r\n    private _previewGrid2:BtnPreviewGrid;\r\n    private _previewGrid3:BtnPreviewGrid;\r\n\r\n    private _txtScore:Label;\r\n\r\n    private _mapItemList:MapGridItem[][];\r\n    private _mapContainer:Node;\r\n    private _rightCount:number = 0;\r\n    private _score:number = 0;\r\n    public update(dt) {\r\n\r\n    }\r\n    public start(): void {\r\n        console.log(\"onGameGridStart\");\r\n        this._mapContainer = this.node.getChildByPath(\"gridMap/items\");\r\n\r\n        this._previewGrid1 = new BtnPreviewGrid(this.node.getChildByName(\"BtnPreviewGrid1\"));\r\n        this._previewGrid1.gridIndex = 1;\r\n        this._previewGrid2 = new BtnPreviewGrid(this.node.getChildByName(\"BtnPreviewGrid2\"));\r\n        this._previewGrid2.gridIndex = 2;\r\n        this._previewGrid3 = new BtnPreviewGrid(this.node.getChildByName(\"BtnPreviewGrid3\"));\r\n        this._previewGrid3.gridIndex = 3;\r\n\r\n        this._txtScore = this.node.getChildByName(\"txtScore\").getComponent(Label);\r\n        this._txtScore.string = \"0\";\r\n\r\n        let btnExit:Node = this.node.getChildByName(\"btnExit\");\r\n        let self = this\r\n        btnExit.on(Button.EventType.CLICK,function(){\r\n            //退出前回到初始化状态\r\n            self.uploadScore();\r\n            self.exitClear();\r\n            EventManager.dispatch(EventEnum.OnGameExit,GameType.Grid);\r\n        });\r\n\r\n        this.initMapGrid();\r\n        EventManager.addListener(EventEnum.OnGameGridTouchEnd,this.OnTouchEndCheck,this);\r\n        EventManager.addListener(EventEnum.OnGameGridReqNextPreview,this.OnReqNextPreview,this);\r\n    }\r\n\r\n    private uploadScore(){\r\n        // wx.cloud.init();\r\n        // let db = wx.cloud.database()\r\n        // let rankData = db.collection('gamegrid_rank');\r\n        // console.log(\"获取排行榜数据\",rankData);\r\n        // let openDataContext = wx.getOpenDataContext();\r\n        // let userStorage = wx.getUserCloudStorage()\r\n        // console.log(\"获取用户托管数据\",userStorage);\r\n        // const score = this._score;//Math.floor(Math.random() * 100)\r\n        // wx.setUserCloudStorage({\r\n        // KVDataList: [\r\n        //         {\r\n        //             key: 'rankid',\r\n        //             value: JSON.stringify({\r\n        //                 wxgame: {\r\n        //                 score: String(score),\r\n        //                 update_time: String(+ new Date() / 1000)\r\n        //                 }\r\n        //             })\r\n        //         },\r\n        //     ],\r\n        //     success: () => {\r\n        //         wx.showToast({\r\n        //             title: `分数上报成功: ${score}分`,\r\n        //             icon: 'none',\r\n        //             duration: 2000\r\n        //         })\r\n        //         console.log('上传成功')\r\n        //     },\r\n        //     fail: (res) => {\r\n        //         console.log(res)\r\n        //     }\r\n        // })\r\n    }\r\n\r\n    private initMapGrid(){\r\n        this._mapItemList = [];\r\n        for(let row = 0; row < 10; row++){\r\n            for(let col = 0; col < 10; col++){\r\n                if(!this._mapItemList[row]){\r\n                    this._mapItemList[row] = [];\r\n                }\r\n                let item:MapGridItem = new MapGridItem();\r\n                this._mapItemList[row][col] = item;\r\n                item.init(col,row,this._mapContainer);\r\n            }\r\n        }\r\n    }\r\n\r\n    private OnReqNextPreview(){\r\n        this._previewGrid1.updatePreviewGrid();\r\n        this._previewGrid2.updatePreviewGrid();\r\n        this._previewGrid3.updatePreviewGrid();\r\n    }\r\n\r\n    private OnTouchEndCheck(index:number,gridList:Node[]){\r\n        let num = gridList.length;\r\n        let emptyNum = 0;\r\n        let itemArr:MapGridItem[] = [];\r\n        for(let i = 0; i < num; i ++) {\r\n            let grid:Node = gridList[i];//GameUI.FindChild(randomGrid,\"grid\" + i);\r\n            let localPos:engine.Vector2 = this._mapContainer.transform2D.convertWorldPositionToLocal(grid.transform2D.worldPosition);\r\n            // console.log(\"坐标转换\" + i + \"----x：\" + localPos.x + \"----y：\" + localPos.y)\r\n            if(localPos.x >= -500 && localPos.x <= 500 && localPos.y >= -500 && localPos.y <= 500){\r\n                //在范围内，进一步检测对应网格是否是空位\r\n                let idx:number[] = this.ConvertXYToIndex(localPos.x,localPos.y);\r\n                // console.log(\"坐标转换行列值\" + i + \"----col：\" + idx[0] + \"----row：\" + idx[1]);\r\n                let item:MapGridItem = this._mapItemList[idx[1]][idx[0]];\r\n                if(item.isEmpty){\r\n                    emptyNum ++;\r\n                    itemArr.push(item);\r\n                }else{\r\n                    //存在非空网格\r\n                    break;\r\n                }\r\n            }\r\n            else{\r\n                //不在网格地图范围内\r\n                break;\r\n            }\r\n        }\r\n\r\n        let checkListX:number[] = [];\r\n        let checkListY:number[] = [];\r\n        if(emptyNum == num){\r\n            for(let i = 0; i < itemArr.length; i ++){\r\n                itemArr[i].setEmpty(false);\r\n                let col:number = itemArr[i].col;\r\n                let row:number = itemArr[i].row;\r\n                if(checkListX.indexOf(col) == -1){\r\n                    checkListX.push(col);\r\n                }\r\n                if(checkListY.indexOf(row) == -1){\r\n                    checkListY.push(row);\r\n                }\r\n            }\r\n            this._rightCount ++;\r\n        }\r\n        this[\"_previewGrid\" + index].UpdateTouchEndResult(emptyNum == num,itemArr);\r\n        if(this._rightCount >= 3){\r\n            this._rightCount = 0;\r\n            this.OnReqNextPreview();\r\n        }\r\n\r\n        for(let i:number = checkListX.length - 1; i >= 0; i--){\r\n            let col:number = checkListX[i];\r\n            for(let row:number = 0; row < 10; row++){\r\n                if(this._mapItemList[row][col].isEmpty){\r\n                    checkListX.splice(i,1);\r\n                    break; \r\n                }\r\n            }\r\n        }\r\n        for(let i:number = checkListY.length - 1; i >= 0 ; i--){\r\n            let row:number = checkListY[i];\r\n            for(let col:number = 0; col < 10; col++){\r\n                if(this._mapItemList[row][col].isEmpty){\r\n                    checkListY.splice(i,1);\r\n                    break; \r\n                }\r\n            }\r\n        }\r\n        let canRemove:boolean = false;\r\n        let lenX:number = checkListX.length;\r\n        let lenY:number = checkListY.length;\r\n        for(let i:number = 0; i < lenX; i++){\r\n            let col:number = checkListX[i];\r\n            for(let row:number = 0; row < 10; row++){\r\n                this._mapItemList[row][col].setEmpty(true,true,1);//1、纵向消除\r\n                canRemove = true\r\n            }\r\n        }\r\n        for(let i:number = 0; i < lenY ; i++){\r\n            let row:number = checkListY[i];\r\n            for(let col:number = 0; col < 10; col++){\r\n                this._mapItemList[row][col].setEmpty(true,true,2);//2、横向消除\r\n                canRemove = true\r\n            }\r\n        }\r\n        this._score += (lenX + lenY);\r\n        this._txtScore.string = this._score + \"\";\r\n        if(canRemove) Mgr.soundMgr.play(\"crrect_answer3\");//存在可消除的行or列\r\n    }\r\n\r\n    //局部坐标转换为网格索引\r\n    private ConvertXYToIndex(posX:number,posY:number):number[]{\r\n        let col = Math.round((posX + 450) / 100);\r\n        let row = Math.round(Math.abs(posY - 450) / 100);\r\n        return [col,row];\r\n    }\r\n\r\n    public OnGameStart(){\r\n        this._score = 0;\r\n        this._txtScore.string = \"0\";\r\n        this.OnReqNextPreview();\r\n    }\r\n    private exitClear(){\r\n        this._rightCount = 0;\r\n        this.node.active = false;\r\n        this._txtScore.string = \"0\";\r\n        this._score = 0;\r\n        for(let i:number = 0; i < this._mapItemList.length; i++){\r\n            for(let k:number = 0; k < this._mapItemList[i].length; k++){\r\n                this._mapItemList[i][k].setEmpty(true);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport class MapGridItem {\r\n    private _col:number;\r\n    private _row:number;\r\n    private _posX:number;\r\n    private _posY:number;\r\n    private _itemEntity:Node;\r\n    private _container:Node;\r\n    private _posArr:number[];\r\n\r\n    private _isEmpty:boolean = true;\r\n    private _playTween:boolean;\r\n    public consturctor(){\r\n\r\n    }\r\n\r\n    public init(col:number,row:number,container:Node){\r\n        this._col = col;\r\n        this._row = row;\r\n        this._posX = -450 + col * 100;\r\n        this._posY = 450 - row * 100;\r\n        this._posArr = [this._posX,this._posY];\r\n        this._container = container;\r\n    }\r\n\r\n    private initUI(){\r\n        let url:string = \"prefab/GameGridMapItem\";\r\n        let prefabAsset:Prefab = resources.get(url);\r\n        if(prefabAsset){\r\n            this._itemEntity = instantiate(prefabAsset);\r\n            this._container.addChild(this._itemEntity);\r\n            this._itemEntity.setPosition(this._posX,this._posY);\r\n        }\r\n    }\r\n\r\n    public get isEmpty():boolean{\r\n        return this._isEmpty;\r\n    }\r\n\r\n    public setEmpty(bool:boolean,playTween:boolean = false,col_row:number = 1){\r\n        this._isEmpty = bool;\r\n        if(!bool){\r\n            if(this._itemEntity){\r\n                this.clearTween();\r\n                this._itemEntity.active = true;\r\n            }\r\n            else{\r\n                this.initUI();\r\n            }\r\n        }\r\n        else{\r\n            if(this._itemEntity){\r\n                if(playTween){\r\n                    if(!this._playTween){\r\n                        this._playTween = true;\r\n                        let index:number = col_row == 1? this._row : this._col;\r\n                        let scale = this._itemEntity.getScale();\r\n                        TweenManager.addTween(scale).wait(0.05 * index).to({x:2,y:2},0.05).to({x:0,y:0},0.1);\r\n                    }\r\n                }\r\n                else{\r\n                    this.clearTween();\r\n                    this._itemEntity.active = false;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private clearTween(){\r\n        if(this._playTween){\r\n            let scale = this._itemEntity.getScale();\r\n            TweenManager.removeTweens(scale);\r\n            scale.x = 1;\r\n            scale.y = 1;\r\n            this._playTween = false;\r\n        }\r\n    }\r\n\r\n    public get position():number[] {\r\n        return this._posArr;\r\n    }\r\n\r\n    public get col():number{\r\n        return this._col;\r\n    }\r\n\r\n    public get row():number{\r\n        return this._row;\r\n    }\r\n\r\n    public getItemWorldPos():math.Vec3{\r\n        if(!this._itemEntity){\r\n            return null;\r\n        }\r\n        \r\n        return this._itemEntity.getWorldPosition();\r\n    }\r\n}\r\n\r\nclass BtnPreviewGrid {\r\n    private _touchMask:Node;\r\n    private _preview:Node;\r\n    private _previewPos:math.Vec3;\r\n    private _previewScale:math.Vec3;\r\n    private _previewX:number;//初始X位置\r\n    private _previewY:number;//初始Y位置\r\n    private _moveStartX:number;\r\n    private _moveStartY:number;\r\n    private _offsetX:number;\r\n    private _offsetY:number;\r\n    private _canMove:boolean;\r\n    private _gridIndex:number;\r\n\r\n    private _randomGrid:Node;\r\n    private _lastRandomGrid:Node;\r\n    private _gridList:Node[];\r\n    private _btnGrid:Node;\r\n    private _node:Node;\r\n    public constructor(node:Node) {\r\n        this._node = node;\r\n        this.initUI();        \r\n    }\r\n\r\n    private initUI(){\r\n        this._preview = this._node.getChildByName(\"preview\");\r\n        this._previewPos = this._preview.getPosition();\r\n        this._previewScale = this._preview.getScale();\r\n        this._previewX = this._previewPos.x;\r\n        this._previewY = this._previewPos.y;\r\n        \r\n\r\n        this._btnGrid = this._node.getChildByName(\"btnGrid\")\r\n        this._btnGrid.on(Node.EventType.TOUCH_CANCEL,function(){\r\n            console.log(\"TOUCH_CANCEL\")\r\n            self.touchEnd();\r\n        });\r\n        \r\n        this._btnGrid.on(NodeEventType.TOUCH_END,function(){\r\n            console.log(\"TOUCH_END\")\r\n            self.touchEnd();\r\n        });\r\n        let self = this;\r\n        this._btnGrid.on(NodeEventType.TOUCH_START,function(target:any,event:any){\r\n            let touches = event.touches[0];\r\n            self.touchStart(touches.position.x,touches.position.y);\r\n            \r\n        });\r\n        this._btnGrid.on(NodeEventType.TOUCH_MOVE,function(target:any,event:any){\r\n            let touches = event.touches[0];\r\n            self.touchMove(touches.position.x,touches.position.y);\r\n        });\r\n        \r\n        this._touchMask = this._node.getChildByName(\"touchMask\");\r\n        this._touchMask.active = false;\r\n\r\n        this.updatePreviewGrid();\r\n    }\r\n\r\n    private touchStart(startX:number,startY:number){\r\n        if(this._canMove) return;\r\n        this._moveStartX = startX;\r\n        this._moveStartY = startY + 200;\r\n        this._offsetX = startX;\r\n        this._offsetY = startY;\r\n        let self = this;\r\n        self._canMove = true;\r\n        TweenManager.removeTweens(this._previewPos);\r\n        TweenManager.removeTweens(this._previewScale);\r\n        TweenManager.addTween(this._previewScale).to({x:2, y:2},0.1);\r\n        TweenManager.addTween(this._previewPos).to({x:this._moveStartX, y:this._moveStartY},0.1);\r\n        Mgr.soundMgr.play(\"crrect_answer1\",false);\r\n    }\r\n\r\n    private touchMove(moveX:number,moveY:number){\r\n        if(this._canMove){\r\n            let offsetX = moveX - this._offsetX;\r\n            let offsetY = moveY - this._offsetY;\r\n            let pos = this._previewPos;\r\n            pos.x = this._moveStartX + offsetX;\r\n            pos.y = this._moveStartY + offsetY;\r\n        }\r\n    }\r\n\r\n    private touchEnd(){\r\n        if(this._canMove){\r\n            this._canMove = false;\r\n            EventManager.dispatch(EventEnum.OnGameGridTouchEnd,this._gridIndex,this._gridList);\r\n        }\r\n    }\r\n\r\n    public UpdateTouchEndResult(isRight:boolean,itemList:MapGridItem[]){\r\n        if(isRight){\r\n            this._touchMask.active = true;\r\n            Mgr.soundMgr.play(\"crrect_answer2\",false);\r\n            let self = this;\r\n            for(let i = 0; i < itemList.length; i++){\r\n                let item:MapGridItem = itemList[i];\r\n                let localPos:math.Vec3 = new math.Vec3();\r\n                this._randomGrid.inverseTransformPoint(localPos,item.getItemWorldPos());\r\n                let grid:Node = this._gridList[i];\r\n                TweenManager.addTween(grid).to({x:localPos.x,y:localPos.y},0.1).call(function(){\r\n                    grid.active = false;\r\n                });\r\n                \r\n            }\r\n        }else{\r\n            // Mgr.soundMgr.play(\"error999\");\r\n            Mgr.soundMgr.play(\"mobile_phone_O\",false);\r\n            TweenManager.removeTweens(this._previewPos);\r\n            TweenManager.removeTweens(this._previewScale);\r\n            TweenManager.addTween(this._previewPos).to({x:this._previewX, y:this._previewY},0.1);\r\n            TweenManager.addTween(this._previewScale).to({x:1, y:1},0.1);\r\n        }\r\n    }\r\n\r\n    public set gridIndex(index:number) {\r\n        this._gridIndex = index;\r\n    }\r\n\r\n    public get gridIndex():number {\r\n        return this._gridIndex;\r\n    }\r\n\r\n    public updatePreviewGrid(){\r\n        this._touchMask.active = false;\r\n        this._preview.setPosition(this._previewX,this._previewY);\r\n        this._preview.setScale(1,1);\r\n        let gridIdx:number = 1 + Math.round(Math.random() * 9);\r\n        let url:string = \"prefab/PreviewGrid\" + gridIdx;\r\n        if(resources.get(url)){\r\n            this.updatePreview(url);\r\n        }else{\r\n            let self = this;\r\n            resources.load(url,function(){\r\n                self.updatePreview(url);\r\n            });\r\n        }\r\n    }\r\n\r\n    private updatePreview(url:string) {\r\n        let prefabAsset:Prefab = resources.get(url);\r\n        let node:Node;\r\n        if(prefabAsset){\r\n            if(this._lastRandomGrid){\r\n                this._lastRandomGrid.destroy();\r\n                this._lastRandomGrid = null;\r\n            }\r\n            if(this._randomGrid){\r\n                //保存上一个格子对象，用于完成3个的缓动效果\r\n                this._lastRandomGrid = this._randomGrid;\r\n                this._randomGrid.active = false;//隐藏上一个，否则会影响下一个格子的布局位置\r\n            }\r\n            node = instantiate(prefabAsset);\r\n            this._preview.addChild(node);\r\n            this._randomGrid = node;\r\n            let num = node.children.length;\r\n            this._gridList = [];\r\n            for(let i = 1; i <= num; i++){\r\n                let grid:Node = node.getChildByName(\"grid\" + i);\r\n                this._gridList.push(grid);\r\n            }\r\n            if(Math.random() > 0.5){\r\n                node.setRotation();\r\n                entity.transform2D.rotation = 90 * Math.PI / 180;\r\n            }\r\n            let scaleX = Math.random() > 0.5 ? -1 : 1;\r\n            let scaleY = Math.random() > 0.5 ? -1 : 1;\r\n            node.setScale(scaleX,scaleY);\r\n        }\r\n        else{\r\n            console.log(\"找不到资源\");\r\n        }\r\n    }\r\n}\r\n"]}